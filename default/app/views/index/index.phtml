
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
    /* Alturas para que Leaflet renderice correctamente */
    #world-map { height: 340px; min-height: 220px; width: 100%; }
    #sparkline-1, #sparkline-2, #sparkline-3 {
        height: 120px;
        width: 100%;
        border-radius: 4px;
        cursor: pointer;
    }
    .leaflet-container { background: transparent; }
</style>

<div class="app-content">
    <!--begin::Container-->
    <div class="container-fluid">
        <!--begin::Row-->
        <div class="row">
            <!--begin::Col-->
            <div class="col-lg-3 col-6">
                <!--begin::Small Box Widget 1-->
                <div class="small-box text-bg-primary">
                    <div class="inner">
                        <h3><?= $medicion->ph ?><sup class="fs-5">%</sup></h3>

                        <p>PH</p>
                    </div>
                    <svg
                            class="small-box-icon"
                            fill="none"
                            viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg"
                            aria-hidden="true"
                    >
                        <!-- Gota principal -->
                        <path
                                d="M12 3C12 3 5 11 5 16a7 7 0 0 0 14 0c0-5-7-13-7-13z"
                                fill="#7ea6d9"
                                stroke="#24364a"
                                stroke-width="1.5"
                        />
                        <!-- Escala de pH (líneas abajo) -->
                        <rect x="7" y="18" width="2" height="1" rx="0.3" fill="#6c86c6"/>
                        <rect x="11" y="18" width="2" height="1" rx="0.3" fill="#6c86c6"/>
                        <rect x="15" y="18" width="2" height="1" rx="0.3" fill="#6c86c6"/>
                        <!-- Letras pH -->
                        <text
                                x="8"
                                y="16"
                                font-family="Arial, Helvetica, sans-serif"
                                font-size="5"
                                fill="#24364a"
                                font-weight="bold"
                        >pH</text>
                        <!-- Burbuja pequeña -->
                        <circle cx="17.5" cy="9" r="1" fill="#6c86c6" stroke="#24364a" stroke-width="0.8"/>
                    </svg>
                    <a
                            href="#"
                            class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
                    >
                        Más información <i class="bi bi-link-45deg"></i>
                    </a>
                </div>
                <!--end::Small Box Widget 1-->
            </div>
            <!--end::Col-->
            <div class="col-lg-3 col-6">
                <!--begin::Small Box Widget 2-->
                <div class="small-box text-bg-success">
                    <div class="inner">
                        <h3><?= $medicion->turbidez ?><sup class="fs-5">%</sup></h3>

                        <p>Turvidez</p>
                    </div>
                    <svg
                            class="small-box-icon"
                            fill="none"
                            viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg"
                            aria-hidden="true"
                    >
                        <!-- Fondo rectangular simulando un recipiente -->
                        <rect x="3" y="5" width="18" height="14" rx="3" fill="#b3c4d1" stroke="#24364a" stroke-width="1.5"/>
                        <!-- Líneas onduladas simulando el agua turbia -->
                        <path d="M5 10c2 1 4 1 6 0s4-1 6 0" stroke="#6c86c6" stroke-width="1" fill="none"/>
                        <path d="M5 13c2 1 4 1 6 0s4-1 6 0" stroke="#6c86c6" stroke-width="1" fill="none"/>
                        <!-- Partículas suspendidas -->
                        <circle cx="7" cy="12" r="0.5" fill="#24364a"/>
                        <circle cx="10" cy="9.5" r="0.7" fill="#24364a"/>
                        <circle cx="12.5" cy="13.5" r="0.4" fill="#24364a"/>
                        <circle cx="15" cy="12" r="0.6" fill="#24364a"/>
                        <circle cx="17" cy="11" r="0.4" fill="#24364a"/>
                    </svg>
                    <a
                            href="#"
                            class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
                    >
                        Más información <i class="bi bi-link-45deg"></i>
                    </a>
                </div>
                <!--end::Small Box Widget 2-->
            </div>
            <!--end::Col-->
            <div class="col-lg-3 col-6">
                <!--begin::Small Box Widget 3-->
                <div class="small-box text-bg-warning">
                    <div class="inner">
                        <h3><?= $medicion->conductividad ?><sup class="fs-5">%</sup></h3>

                        <p>Conductividad</p>
                    </div>
                    <svg
                            class="small-box-icon"
                            fill="none"
                            viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg"
                            aria-hidden="true"
                    >
                        <!-- Recipiente con agua -->
                        <rect x="4" y="8" width="16" height="9" rx="2" fill="#7ea6d9" stroke="#24364a" stroke-width="1.5"/>
                        <!-- Electrodo izquierdo -->
                        <rect x="7" y="6" width="1.2" height="7" rx="0.5" fill="#6c86c6" stroke="#24364a" stroke-width="0.8"/>
                        <!-- Electrodo derecho -->
                        <rect x="15.8" y="6" width="1.2" height="7" rx="0.5" fill="#6c86c6" stroke="#24364a" stroke-width="0.8"/>
                        <!-- Líneas de corriente -->
                        <path d="M8.5 12c1 .8 2 .8 3 0s2-.8 3 0" stroke="#24364a" stroke-width="1" fill="none"/>
                        <path d="M8.5 14c1 .8 2 .8 3 0s2-.8 3 0" stroke="#24364a" stroke-width="1" fill="none"/>
                    </svg>
                    <a
                            href="#"
                            class="small-box-footer link-dark link-underline-opacity-0 link-underline-opacity-50-hover"
                    >
                        Más información <i class="bi bi-link-45deg"></i>
                    </a>
                </div>
                <!--end::Small Box Widget 3-->
            </div>
            <!--end::Col-->
            <div class="col-lg-3 col-6">
                <!--begin::Small Box Widget 4-->
                <div class="small-box text-bg-danger">
                    <div class="inner">
                        <h3><?= $medicion->nivel_agua ?><sup class="fs-5">%</sup></h3>

                        <p>Nivel de agua</p>
                    </div>
                    <svg
                            class="small-box-icon"
                            fill="none"
                            viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg"
                            aria-hidden="true"
                    >
                        <!-- Recipiente -->
                        <rect x="5" y="5" width="14" height="14" rx="3" fill="#e3eafd" stroke="#24364a" stroke-width="1.5"/>
                        <!-- Agua dentro del recipiente (nivel medio) -->
                        <rect x="6.5" y="13" width="11" height="5" rx="2" fill="#7ea6d9"/>
                        <!-- Línea de nivel de agua -->
                        <rect x="6.5" y="13" width="11" height="0.8" fill="#6c86c6"/>
                        <!-- Marca de nivel a la izquierda -->
                        <rect x="5" y="13" width="1" height="2" fill="#6c86c6" rx="0.5"/>
                        <!-- Marca de nivel a la derecha -->
                        <rect x="18" y="13" width="1" height="2" fill="#6c86c6" rx="0.5"/>
                    </svg>
                    <a
                            href="#"
                            class="small-box-footer link-light link-underline-opacity-0 link-underline-opacity-50-hover"
                    >
                        Más información <i class="bi bi-link-45deg"></i>
                    </a>
                </div>
                <!--end::Small Box Widget 4-->
            </div>
            <!--end::Col-->
        </div>
        <!--end::Row-->
        <!--begin::Row-->
        <div class="row">
            <!-- Start col -->
            <div class="col-lg-7 connectedSortable">
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="card-title">Grafica General</h3>
                    </div>
                    <div class="card-body">
                        <div id="revenue-chart"></div>
                    </div>

                </div>
                <!-- /.card -->

            </div>
            <!-- /.Start col -->

            <!-- Start col -->
            <div class="col-lg-5 connectedSortable">
                <div class="card text-white bg-primary bg-gradient border-primary mb-4">
                    <div class="card-header border-0">
                        <h3 class="card-title">Río San Juan</h3>
                    </div>
                    <div class="card-body">
                        <!-- Mapa principal: tiene controles de zoom añadidos -->
                        <div id="world-map"></div>
                    </div>
                    <div class="card-footer border-0">
                        <!--begin::Row-->
                        <div class="row">
                            <div class="col-4 text-center">
                                <div id="sparkline-1" class="text-dark"></div>
                                <div class="text-white">Zona A</div>
                            </div>
                            <div class="col-4 text-center">
                                <div id="sparkline-2" class="text-dark"></div>
                                <div class="text-white">Zona B</div>
                            </div>
                            <div class="col-4 text-center">
                                <div id="sparkline-3" class="text-dark"></div>
                                <div class="text-white">Zona C</div>
                            </div>
                        </div>
                        <!--end::Row-->
                    </div>
                </div>
            </div>
            <!-- /.Start col -->
        </div>
        <!-- /.row (main row) -->
    </div>
    <!--end::Container-->
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {

        const tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
        const tileAttribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a>';

        const worldMap = L.map('world-map').setView([20.39, -100.00], 10);
        L.tileLayer(tileUrl, {
            attribution: tileAttribution,
            maxZoom: 18,
        }).addTo(worldMap);

        const map1 = L.map('sparkline-1', { zoomControl: false }).setView([20.37020147646502, -100.00055783103], 15);
        L.tileLayer(tileUrl, { attribution: 'OSM' }).addTo(map1);
        //L.marker([20.37020147646502, -100.00055783103]).addTo(map1);

        const map2 = L.map('sparkline-2', { zoomControl: false }).setView([20.385768537735302, -100.00464033212025], 15);
        L.tileLayer(tileUrl, { attribution: 'OSM' }).addTo(map2);

        const map3 = L.map('sparkline-3', { zoomControl: false }).setView([20.396550744367527, -100.00098946005606], 15);
        L.tileLayer(tileUrl, { attribution: 'OSM' }).addTo(map3);


        document.getElementById('sparkline-1').addEventListener('click', function() {
            worldMap.flyTo(map1.getCenter(), map1.getZoom());
        });

        document.getElementById('sparkline-2').addEventListener('click', function() {
            worldMap.flyTo(map2.getCenter(), map2.getZoom());
        });

        document.getElementById('sparkline-3').addEventListener('click', function() {
            worldMap.flyTo(map3.getCenter(), map3.getZoom());
        });

    });
</script>