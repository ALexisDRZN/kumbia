<!doctype html>
<html lang="en">
<!--begin::Head-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AdminLTE 4 | Simple Tables</title>

    <!--begin::Accessibility Meta Tags-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="color-scheme" content="light dark" />
    <meta name="theme-color" content="#007bff" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#1a1a1a" media="(prefers-color-scheme: dark)" />
    <!--end::Accessibility Meta Tags-->

    <!--begin::Primary Meta Tags-->
    <meta name="title" content="AdminLTE 4 | Simple Tables" />
    <meta name="author" content="ColorlibHQ" />
    <meta
        name="description"
        content="AdminLTE is a Free Bootstrap 5 Admin Dashboard, 30 example pages using Vanilla JS. Fully accessible with WCAG 2.1 AA compliance."
    />
    <meta
        name="keywords"
        content="bootstrap 5, bootstrap, bootstrap 5 admin dashboard, bootstrap 5 dashboard, bootstrap 5 charts, bootstrap 5 calendar, bootstrap 5 datepicker, bootstrap 5 tables, bootstrap 5 datatable, vanilla js datatable, colorlibhq, colorlibhq dashboard, colorlibhq admin dashboard, accessible admin panel, WCAG compliant"
    />
    <!--end::Primary Meta Tags-->

    <!--begin::Accessibility Features-->
    <!-- Skip links will be dynamically added by accessibility.js -->
    <meta name="supported-color-schemes" content="light dark" />
    <link rel="preload" href="../css/adminlte.css" as="style" />
    <!--end::Accessibility Features-->

    <!--begin::Fonts-->
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
        integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q="
        crossorigin="anonymous"
        media="print"
        onload="this.media='all'"
    />
    <!--end::Fonts-->

    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/styles/overlayscrollbars.min.css"
        crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(OverlayScrollbars)-->

    <!--begin::Third Party Plugin(Bootstrap Icons)-->
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
        crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(Bootstrap Icons)-->

    <!--begin::Required Plugin(AdminLTE)-->
    <link rel="stylesheet" href="../css/adminlte.css" />
    <!--end::Required Plugin(AdminLTE)-->
</head>
<!--end::Head-->
<!--begin::Body-->
<body class="layout-fixed sidebar-expand-lg sidebar-open bg-body-tertiary">
<!--begin::App Wrapper-->
<div class="app-wrapper">


    <!--begin::App Main-->
    <main class="app-main">
        <div class="app-content">
            <!--begin::Container-->
            <div class="container-fluid">

                <!-- Formulario reportes -->
                <div class="card card-primary card-outline mb-4">
                    <div class="card-header">
                        <div class="card-title">Nuevo reporte</div>
                    </div>

                    <!-- Nota: el controlador espera POST['reporte'][...] y $_FILES['foto'] -->
                    <form id="reportForm" action="/kumbia/reportes/guardar/" method="post" enctype="multipart/form-data" novalidate>
                        <div class="card-body">
                            <label for="ubicacion" class="form-label">Deceas enviarlo como anónimo <span class="nombre-usuario"></span> </label>
                            <!-- Opción anonimato -->
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="anonimo" name="reporte[anonimo]" value="1">
                                <label class="form-check-label" for="anonimo">Enviar como anónimo</label>
                            </div>
                            <!--
                            <div class="mb-3">
                                <label for="ubicacion" class="form-label">Ubicación</label>
                                <input type="text" class="form-control" id="ubicacion" name="reporte[ubicacion]" placeholder="Latitud,Longitud" readonly required>
                                <div class="form-text">Permite el acceso a tu ubicación para detectarla automáticamente.</div>
                            </div>
                            -->
                            <!-- Selección de zona (desde DB) -->
                            <div class="mb-3">
                                <label for="zona_id" class="form-label">Zona</label>
                                <select id="zona_id" name="reporte[zona_id]" class="form-select" required>
                                    <option value="">-- Selecciona una zona --</option>
                                    <?php foreach ($zonas as $z): ?>
                                        <option value="<?= $z->id ?>"><?= htmlspecialchars($z->nombre) ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>

                            <!-- Contexto (max 255) -->
                            <div class="mb-3">
                                <label for="contexto" class="form-label">Contexto</label>
                                <textarea class="form-control" id="contexto" name="reporte[contexto]" rows="2" maxlength="255" placeholder="Describe el contexto (máx 255 caracteres)"></textarea>
                                <div class="form-text"><span id="contextoCount">0</span>/255</div>
                            </div>

                            <!-- Causa (max 255) -->
                            <div class="mb-3">
                                <label for="causa" class="form-label">Posible causa de contaminación</label>
                                <textarea class="form-control" id="causa" name="reporte[causa]" rows="2" maxlength="255" placeholder="Describe la posible causa (máx 255 caracteres)"></textarea>
                                <div class="form-text"><span id="causaCount">0</span>/255</div>
                            </div>

                            <!-- Foto -->
                            <div class="mb-3">
                                <label for="causa" class="form-label">Fotografia</label>
                                <input type="file" id="archivo" name="archivo" class="form-control" accept="image/*,application/pdf">
                                <div class="form-text">Formatos: JPG, PNG, GIF, WebP, PDF</div>
                            </div>

                            <!-- Campos ocultos -->
                            <input type="hidden" id="fecha_hora" name="reporte[fecha_hora]" value="">
                            <input type="hidden" id="lat" name="reporte[lat]" value="">
                            <input type="hidden" id="lng" name="reporte[lng]" value="">
                        </div>

                        <div class="card-footer">
                            <button type="submit" class="btn btn-primary">Guardar reporte</button>
                        </div>
                    </form>
                </div>


                <!--begin::Row-->

                <div class="row">
                    <div class="col-12"> <!-- Cambiado a col-12 para ocupar todo el ancho -->
                        <div class="card mb-4 w-100">
                            <div class="card-header">
                                <h3 class="card-title">Reportes</h3>
                            </div>
                            <!-- /.card-header -->
                            <div class="card-body">
                                <div class="table-responsive"> <!-- Hace la tabla scrolleable si se desborda -->
                                    <table class="table table-bordered">
                                        <thead>
                                        <tr>
                                            <th style="width: 10px">User</th>
                                            <th>Ubicación</th>
                                            <th>Contexto</th>
                                            <th>Posible causa de contaminación</th>
                                            <th>Fecha</th>
                                            <th>Foto</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                            <?php foreach ($reportes as $f): ?>
                                                <tr class="align-middle">
                                                    <td><?= $f-> user_2 ?></td>
                                                    <td><?= $f-> getzonas() -> nombre ?></td>
                                                    <td><?= $f->contexto ?></td>
                                                    <td><?= $f->causa ?></td>
                                                    <td><?= $f->fecha_hora ?></td>
                                                    <td><?= Bhtml::img("reportes/{$f->id}.jpg", "", ["width" => "128px"]) ?></td>

                                                </tr>
                                            <?php endforeach; ?>
                                        </tbody>
                                    </table>
                                </div><!-- /.table-responsive -->
                            </div>
                        </div>
                    </div>
                </div>

                <!--end::Row-->
            </div>
            <!--end::Container-->
        </div>

</div>
<!--end::App Wrapper-->
<!--begin::Script-->
<!--begin::Third Party Plugin(OverlayScrollbars)-->
<script
    src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.11.0/browser/overlayscrollbars.browser.es6.min.js"
    crossorigin="anonymous"
></script>
<!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
<script
    src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    crossorigin="anonymous"
></script>
<!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"
    crossorigin="anonymous"
></script>
<!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
<script src="../js/adminlte.js"></script>
<!--end::Required Plugin(AdminLTE)--><!--begin::OverlayScrollbars Configure-->
<script>
    const SELECTOR_SIDEBAR_WRAPPER = '.sidebar-wrapper';
    const Default = {
        scrollbarTheme: 'os-theme-light',
        scrollbarAutoHide: 'leave',
        scrollbarClickScroll: true,
    };
    document.addEventListener('DOMContentLoaded', function () {
        const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);

        // Disable OverlayScrollbars on mobile devices to prevent touch interference
        const isMobile = window.innerWidth <= 992;

        if (
            sidebarWrapper &&
            OverlayScrollbarsGlobal?.OverlayScrollbars !== undefined &&
            !isMobile
        ) {
            OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
                scrollbars: {
                    theme: Default.scrollbarTheme,
                    autoHide: Default.scrollbarAutoHide,
                    clickScroll: Default.scrollbarClickScroll,
                },
            });
        }
    });
</script>
<!--end::OverlayScrollbars Configure-->
<!--end::Script-->
</body>
<!--end::Body-->
</html>
